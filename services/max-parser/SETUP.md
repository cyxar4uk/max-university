# Быстрая инструкция по запуску MAX-парсера

## Шаг 1: Установка зависимостей

```bash
cd services/max-parser
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

## Шаг 2: Настройка .env

Скопируйте `.env.example` в `.env` и заполните:

```bash
cp .env.example .env
```

**Обязательные переменные:**
- `MAX_PHONE` - ваш номер телефона в формате +79001234567
- `MONGOdb` - строка подключения к MongoDB (та же, что и для Telegram-парсера)
- `GIGACHAT_AUTH_URL` - URL авторизации GigaChat
- `GIGACHAT_API_URL` - URL API GigaChat
- `CLIENT_ID` - ID клиента GigaChat
- `CLIENT_SECRET` - Secret клиента GigaChat

## Шаг 3: Первый запуск

```bash
python parser.py
# или
python run.py
```

**При первом запуске:**
- Если `MAX_USE_SOCKET=true` (по умолчанию): введите код подтверждения из SMS
- Если `MAX_USE_SOCKET=false`: отсканируйте QR-код из приложения MAX

После успешной авторизации сессия сохранится в `./cache/`.

## Шаг 4: Проверка работы

Парсер должен:
1. ✅ Подключиться к MAX
2. ✅ Загрузить список каналов
3. ✅ Начать мониторинг новых сообщений
4. ✅ Сохранять посты в MongoDB

## Структура файлов

```
max-parser/
├── parser.py          # Основной парсер (запуск: python parser.py)
├── run.py             # Альтернативный скрипт запуска
├── models.py          # Работа с MongoDB
├── classifier.py      # Классификация через GigaChat
├── channels_config.py # Конфигурация каналов
├── requirements.txt   # Зависимости
├── .env.example       # Пример переменных окружения
├── README.md          # Полная документация
└── SETUP.md           # Эта инструкция
```

## Важные замечания

1. **Каналы**: Парсер автоматически находит все каналы, на которые подписан аккаунт через `fetch_chats()`
2. **MongoDB**: Используется та же коллекция `news_posts`, что и Telegram-парсер
3. **GigaChat**: Используется та же логика классификации, что и в Telegram-парсере
4. **Сессия**: После первого успешного входа сессия сохраняется, повторный вход не требуется

## Решение проблем

### Ошибка "MAX_PHONE не указан"
- Проверьте файл `.env` и убедитесь, что переменная `MAX_PHONE` заполнена

### Ошибка подключения к MongoDB
- Проверьте строку подключения `MONGOdb` в `.env`
- Убедитесь, что MongoDB доступна

### Не находит каналы
- Убедитесь, что аккаунт подписан на каналы в MAX
- Проверьте логи - там будет информация о найденных каналах

### Ошибки GigaChat
- Проверьте правильность ключей `CLIENT_ID` и `CLIENT_SECRET`
- Убедитесь, что URL GigaChat указаны правильно
