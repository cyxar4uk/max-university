# Чат-бот MAX — Цифровой университет

Бот на **TypeScript** с библиотекой [max-bot-api-client-ts](https://github.com/max-messenger/max-bot-api-client-ts).

**Назначение:** при запуске бота (или открытии чата) отправляет приветствие и клавиатуру с **4 кнопками выбора роли**: Абитуриент, Студент, Сотрудник, Родитель. Роль сохраняется в бэкенде; после выбора показывается кнопка «Открыть приложение» (мини-приложение в MAX).

## Установка

```bash
cd services/max-bot
npm install
```

## Настройка

1. Скопируйте `.env.example` в `.env`.
2. Заполните `BOT_TOKEN` (токен от PrimeBot в MAX).
3. Укажите `BACKEND_URL` (адрес FastAPI, например `http://127.0.0.1:8000`).
4. Укажите `MINI_APP_URL` (URL мини-приложения, например `https://max-university.anyway-community.ru`).
5. Опционально: `BOT_SECRET` для заголовка `X-Bot-Secret` при вызове `/api/bot/sync-user`.

## Запуск

```bash
npm run build
npm start
```

## Поведение

- **`/start`** и **`bot_started`**: приветствие + клавиатура с 4 ролями (если роль не выбрана) или кнопка «Открыть приложение» (если роль уже есть).
- **Нажатие на кнопку роли**: сохранение роли через `POST /api/bot/sync-user`, уведомление и кнопка «Открыть приложение».
- **Любое другое сообщение**: ответ «Я не знаю такой команды. Используйте /start».

В настройках бота на платформе MAX **не задаётся URL вебхука** — бот получает обновления через Long Polling по токену.

## Деплой

На VPS бот запускается как systemd-сервис `max-university-bot` (см. `deploy/max-university-bot.service` и `docs/VPS_DEPLOY.md`).
