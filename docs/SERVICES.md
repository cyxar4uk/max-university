# Сервисы проекта «Цифровой университет MAX»

Проект состоит из четырёх основных частей.

---

## 1. Мини-приложение (веб-приложение внутри бота MAX)

- **Что это:** веб-приложение, которое открывается внутри мессенджера MAX (в том же боте, где есть чат-бот).
- **Содержит:** хаб, главная страница, учебный раздел и др.
- **Реализация:** фронтенд (например, Vite + React) в папке `frontend/`. Собирается в статику и отдаётся с того же домена, что и бэкенд (или с отдельного хоста).
- **Деплой:** статика кладётся в корень сайта на VPS (см. `docs/VPS_DEPLOY.md`).

---

## 2. Сервис парсера постов

- **Что это:** сервис, который парсит посты из MAX, сохраняет их в MongoDB и обрабатывает через GigaChat для определения топика поста.
- **Реализация:** код в `services/max-parser/` (и при необходимости части в `services/cold-news/`).
- **БД:** MongoDB (источники, посты, топики).
- **Деплой:** отдельный процесс/сервис на VPS (см. `services/max-parser/README.md`, `SETUP.md`).

---

## 3. Сервис ленты постов

- **Что это:** API, которое собирает посты из MongoDB в ленту с возможностью фильтрации по источникам.
- **Реализация:** например, `services/cold-news/feed-api.js` — отдаёт ленту по запросу.
- **БД:** та же MongoDB, что и у парсера.
- **Деплой:** отдельный systemd-сервис (например, `cold-news-feed-api.service`) на VPS. Бэкенд обращается к ленте по URL (например, `COLD_NEWS_FEED_URL=http://127.0.0.1:3001`).

---

## 4. Чат-бот в MAX

- **Что это:** чат-бот в мессенджере MAX. Обрабатывает команды; главная функция — при запуске бота (или открытии чата с ботом) отправить приветственное сообщение и сообщение с **обязательным выбором роли** через клавиатуру (Keyboard API MAX).
- **Кнопки роли (4 штуки):** Абитуриент, Студент, Сотрудник, Администрация.
- **Реализация:** TypeScript-сервис в `services/max-bot/` на базе [@maxhub/max-bot-api](https://github.com/max-messenger/max-bot-api-client-ts). Получение обновлений — через Long Polling (в настройках бота на платформе MAX вебхук не задаётся; команды обрабатываются по токену бота).
- **Поведение:**
  - `/start` или событие `bot_started`: приветствие + клавиатура с 4 кнопками выбора роли (если роль ещё не выбрана) или кнопка «Открыть приложение» (если роль уже есть).
  - Нажатие на кнопку роли: сохранение роли в бэкенде (POST `/api/bot/sync-user`), ответ пользователю и кнопка «Открыть приложение».
  - Любое другое сообщение: ответ «Я не знаю такой команды. Используйте /start».
- **Бэкенд:** FastAPI (`backend/`) отдаёт API для мини-приложения и эндпоинт `POST /api/bot/sync-user` для синхронизации пользователя и роли из чат-бота. БД пользователей — PostgreSQL (или SQLite по умолчанию).

---

## Сводка

| Сервис           | Назначение                          | Деплой / как запускается      |
|------------------|-------------------------------------|-------------------------------|
| Мини-приложение  | Веб-интерфейс в MAX (хаб, главная) | Статика на VPS (nginx и т.п.) |
| Парсер постов    | Парсинг MAX → MongoDB, GigaChat    | Отдельный процесс на VPS      |
| Лента постов     | API ленты из MongoDB               | Отдельный сервис (например, cold-news-feed-api) |
| Чат-бот          | Приветствие + выбор роли (4 кнопки)| Отдельный Node-сервис (max-university-bot) |

Деплой на VPS описан в **`docs/VPS_DEPLOY.md`**.
